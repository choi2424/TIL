-- 게시판 테이블 생성

CREATE TABLE BOARD (
    BNO      NUMBER,
    TITLE    VARCHAR2(100)  NOT NULL,        -- 제목
    CONTENT  VARCHAR2(1000) NOT NULL,        -- 내용
    WRITER   VARCHAR2(100)  NOT NULL,        -- 작성자
    REGDATE     DATE     DEFAULT SYSDATE,    -- 등록일
    UPDATEDDATE DATE     DEFAULT SYSDATE,    -- 수정일
    VIEWCOUNT   NUMBER  DEFAULT 0,           -- 조회수
    CONSTRAINT PK_BOARD PRIMARY KEY(BNO)
);
-- 조회수 작업


-- 테이블 삭제
DROP TABLE BOARD;

-- 시퀀스 생성
CREATE SEQUENCE SEQ_BOARD;

-- 시퀀스 삭제
DROP SEQUENCE SEQ_BOARD;
-- 시퀀스 명령어
/*
    - SEQ_BOARD.NEXTVAL : 시퀀스에서 다음 순번 값을 자동으로 가져온다
    - SEQ_BOARD.CURRVAL : 시퀀스의 현재 값을 알수있다.
*/

SELECT SEQ_BOARD.NEXTVAL FROM DUAL;

SELECT SEQ_BOARD.CURRVAL FROM DUAL;

INSERT INTO BOARD(BNO, TITLE, CONTENT, WRITER) VALUES(SEQ_BOARD.NEXTVAL, '테스트','스프링 게시판연습','USER01');
-- 최신글 순서
SELECT BNO,TITLE,CONTENT,WRITER,REGDATE,UPDATEDDATE 
FROM BOARD 
ORDER BY BNO DESC;

-- 게시물 읽기
SELECT BNO,TITLE,CONTENT,WRITER,REGDATE,UPDATEDDATE 
FROM BOARD 
WHERE BNO = ?;
-- 게시물 수정
UPDATE BOARD SET TITLE = ? , CONTENT = ? ,UPDATEDDATE = SYSDATE WHERE BNO = ?;
SELECT * FROM BOARD;
--컬럼명 변경
ALTER TABLE BOARD
RENAME COLUMN UPDATEDATE TO UPDATEDDATE;

-- 이전페이지 다음페이지 버튼
SELECT BNO, TITLE, CONTENT, WRITER, REGDATE, UPDATEDDATE
		FROM (
    		SELECT /*+ INDEX_DESC(board pk_board) */
    	ROWNUM RN, BNO, TITLE, CONTENT, WRITER, REGDATE, UPDATEDDATE 
    	FROM BOARD 
    	WHERE ROWNUM <= #{pageNum} * #{amount}
    	)
		WHERE RN > (#{pageNum} -1) * #{amount}
-- 더미 데이터 생성

INSERT INTO BOARD(BNO, TITLE, CONTENT, WRITER)
SELECT SEQ_BOARD.NEXTVAL, TITLE, CONTENT, WRITER FROM BOARD;

-- 데이터 변경
UPDATE BOARD
SET TITLE = '사과'
WHERE BNO IN (145 , 100 , 98 , 38 , 74 , 55 , 30 , 7 , 12 , 62 , 82 , 201);

UPDATE BOARD
SET WRITER = 'USER02'
WHERE BNO IN (1145 , 1100 , 198 , 138 , 174 , 155 , 130 , 17 , 112 , 162 , 182 , 1201);

-- 조회수 증가작업
UPDATE BOARD
SET viewcount = viewcount + 1
WHERE BNO = #{bno};

UPDATE BOARD
SET viewcount = 0;

COMMIT;
